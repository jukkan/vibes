<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Text Diff - vibes</title>
  <style>
    :root {
      --primary: #e81123;
      --bg: #1d1d1d;
      --text: #ffffff;
      --surface: #2d2d2d;
      --border: #404040;
      --added: #107c10;
      --removed: #e81123;
      --changed: #ff8c00;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 20px;
      background: var(--bg);
      border-bottom: 1px solid var(--border);
    }

    header a {
      color: #0078d4;
      text-decoration: none;
      font-size: 14px;
    }

    header a:hover {
      text-decoration: underline;
    }

    h1 {
      margin: 10px 0 5px 0;
      font-size: 32px;
      font-weight: 600;
    }

    header p {
      color: #999;
      font-size: 16px;
    }

    main {
      flex: 1;
      padding: 20px;
      max-width: 1400px;
      width: 100%;
      margin: 0 auto;
    }

    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: opacity 0.2s;
    }

    button:hover {
      opacity: 0.9;
    }

    button:active {
      opacity: 0.7;
    }

    button.secondary {
      background: var(--surface);
      border: 1px solid var(--border);
    }

    .editor-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    @media (min-width: 768px) {
      .editor-container {
        grid-template-columns: 1fr 1fr;
      }
    }

    .editor-panel {
      display: flex;
      flex-direction: column;
    }

    .panel-header {
      background: var(--surface);
      padding: 12px 15px;
      border: 1px solid var(--border);
      border-bottom: none;
      border-radius: 4px 4px 0 0;
      font-size: 14px;
      font-weight: 600;
    }

    textarea {
      width: 100%;
      background: var(--surface);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 0 0 4px 4px;
      padding: 15px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 13px;
      resize: vertical;
      min-height: 300px;
      line-height: 1.5;
    }

    .diff-output {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 0;
      margin-top: 20px;
      display: none;
    }

    .diff-output.active {
      display: block;
    }

    .diff-header {
      padding: 12px 15px;
      border-bottom: 1px solid var(--border);
      font-size: 14px;
      font-weight: 600;
    }

    .diff-content {
      padding: 15px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 13px;
      line-height: 1.6;
      max-height: 600px;
      overflow-y: auto;
    }

    .diff-line {
      padding: 2px 8px;
      margin: 0 -8px;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .diff-line.added {
      background: rgba(16, 124, 16, 0.2);
      border-left: 3px solid var(--added);
      padding-left: 5px;
    }

    .diff-line.removed {
      background: rgba(232, 17, 35, 0.2);
      border-left: 3px solid var(--removed);
      padding-left: 5px;
    }

    .diff-line.changed {
      background: rgba(255, 140, 0, 0.2);
      border-left: 3px solid var(--changed);
      padding-left: 5px;
    }

    .diff-line .prefix {
      display: inline-block;
      width: 20px;
      color: #999;
      user-select: none;
    }

    .stats {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      font-size: 13px;
      color: #999;
      flex-wrap: wrap;
    }

    .stat-item {
      background: var(--surface);
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid var(--border);
    }

    .stat-item.added {
      border-left: 3px solid var(--added);
    }

    .stat-item.removed {
      border-left: 3px solid var(--removed);
    }

    .stat-label {
      color: #666;
      margin-right: 6px;
    }

    .empty-state {
      text-align: center;
      color: #666;
      padding: 60px 20px;
      font-size: 16px;
    }

    footer {
      padding: 20px;
      text-align: center;
      color: #666;
      border-top: 1px solid var(--border);
    }

    footer a {
      color: #0078d4;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 640px) {
      h1 {
        font-size: 24px;
      }

      .controls {
        flex-direction: column;
      }

      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <header>
    <a href="/">← vibes</a>
    <h1>Text Diff</h1>
    <p>Compare two text blocks side-by-side</p>
  </header>

  <main>
    <div class="controls">
      <button id="compareBtn">Compare Texts</button>
      <button id="swapBtn" class="secondary">Swap Left ↔ Right</button>
      <button id="clearBtn" class="secondary">Clear All</button>
    </div>

    <div class="editor-container">
      <div class="editor-panel">
        <div class="panel-header">Original Text (Left)</div>
        <textarea id="text1" placeholder="Paste original text here..."></textarea>
      </div>

      <div class="editor-panel">
        <div class="panel-header">Modified Text (Right)</div>
        <textarea id="text2" placeholder="Paste modified text here..."></textarea>
      </div>
    </div>

    <div class="stats" id="stats" style="display: none;">
      <div class="stat-item added">
        <span class="stat-label">Added:</span>
        <span id="addedCount">0 lines</span>
      </div>
      <div class="stat-item removed">
        <span class="stat-label">Removed:</span>
        <span id="removedCount">0 lines</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Unchanged:</span>
        <span id="unchangedCount">0 lines</span>
      </div>
    </div>

    <div class="diff-output" id="diffOutput">
      <div class="diff-header">Differences</div>
      <div class="diff-content" id="diffContent">
        <div class="empty-state">No differences found</div>
      </div>
    </div>
  </main>

  <footer>
    <a href="/">← Back to launcher</a> |
    <a href="https://github.com/jukkan/vibes">View source</a>
  </footer>

  <script>
    const text1Area = document.getElementById('text1');
    const text2Area = document.getElementById('text2');
    const compareBtn = document.getElementById('compareBtn');
    const swapBtn = document.getElementById('swapBtn');
    const clearBtn = document.getElementById('clearBtn');
    const diffOutput = document.getElementById('diffOutput');
    const diffContent = document.getElementById('diffContent');
    const stats = document.getElementById('stats');
    const addedCount = document.getElementById('addedCount');
    const removedCount = document.getElementById('removedCount');
    const unchangedCount = document.getElementById('unchangedCount');

    // Load state from URL hash
    function loadState() {
      if (location.hash) {
        try {
          const state = JSON.parse(decodeURIComponent(location.hash.slice(1)));
          if (state.text1) text1Area.value = state.text1;
          if (state.text2) text2Area.value = state.text2;
          if (state.text1 || state.text2) {
            compareTexts();
          }
        } catch (e) {
          // Invalid hash, ignore
        }
      }
    }

    // Save state to URL hash
    function saveState() {
      const state = {
        text1: text1Area.value,
        text2: text2Area.value
      };
      location.hash = encodeURIComponent(JSON.stringify(state));
    }

    // Simple line-based diff algorithm
    function computeDiff(text1, text2) {
      const lines1 = text1.split('\n');
      const lines2 = text2.split('\n');
      const diff = [];

      let i = 0, j = 0;

      while (i < lines1.length || j < lines2.length) {
        if (i >= lines1.length) {
          // Remaining lines in text2 are added
          diff.push({ type: 'added', line: lines2[j] });
          j++;
        } else if (j >= lines2.length) {
          // Remaining lines in text1 are removed
          diff.push({ type: 'removed', line: lines1[i] });
          i++;
        } else if (lines1[i] === lines2[j]) {
          // Lines match
          diff.push({ type: 'unchanged', line: lines1[i] });
          i++;
          j++;
        } else {
          // Lines differ - look ahead to see if we can find a match
          const lookahead = 3;
          let foundInText2 = -1;
          let foundInText1 = -1;

          // Check if lines1[i] appears soon in lines2
          for (let k = 1; k <= lookahead && j + k < lines2.length; k++) {
            if (lines1[i] === lines2[j + k]) {
              foundInText2 = k;
              break;
            }
          }

          // Check if lines2[j] appears soon in lines1
          for (let k = 1; k <= lookahead && i + k < lines1.length; k++) {
            if (lines2[j] === lines1[i + k]) {
              foundInText1 = k;
              break;
            }
          }

          if (foundInText2 > 0 && (foundInText1 < 0 || foundInText2 <= foundInText1)) {
            // lines1[i] found in lines2, so lines before it were added
            for (let k = 0; k < foundInText2; k++) {
              diff.push({ type: 'added', line: lines2[j + k] });
            }
            j += foundInText2;
          } else if (foundInText1 > 0) {
            // lines2[j] found in lines1, so lines before it were removed
            for (let k = 0; k < foundInText1; k++) {
              diff.push({ type: 'removed', line: lines1[i + k] });
            }
            i += foundInText1;
          } else {
            // No match found, treat as changed
            diff.push({ type: 'removed', line: lines1[i] });
            diff.push({ type: 'added', line: lines2[j] });
            i++;
            j++;
          }
        }
      }

      return diff;
    }

    function compareTexts() {
      const text1 = text1Area.value;
      const text2 = text2Area.value;

      if (!text1 && !text2) {
        diffOutput.classList.remove('active');
        stats.style.display = 'none';
        return;
      }

      const diff = computeDiff(text1, text2);

      // Count stats
      let added = 0, removed = 0, unchanged = 0;
      diff.forEach(item => {
        if (item.type === 'added') added++;
        else if (item.type === 'removed') removed++;
        else unchanged++;
      });

      // Update stats
      addedCount.textContent = `${added} line${added !== 1 ? 's' : ''}`;
      removedCount.textContent = `${removed} line${removed !== 1 ? 's' : ''}`;
      unchangedCount.textContent = `${unchanged} line${unchanged !== 1 ? 's' : ''}`;
      stats.style.display = 'flex';

      // Render diff
      if (diff.length === 0 || (added === 0 && removed === 0)) {
        diffContent.innerHTML = '<div class="empty-state">No differences found</div>';
      } else {
        let html = '';
        diff.forEach(item => {
          const prefix = item.type === 'added' ? '+' :
                        item.type === 'removed' ? '-' : ' ';
          const escapedLine = escapeHtml(item.line);
          html += `<div class="diff-line ${item.type}"><span class="prefix">${prefix}</span>${escapedLine}</div>`;
        });
        diffContent.innerHTML = html;
      }

      diffOutput.classList.add('active');
      saveState();
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function swapTexts() {
      const temp = text1Area.value;
      text1Area.value = text2Area.value;
      text2Area.value = temp;
      if (diffOutput.classList.contains('active')) {
        compareTexts();
      }
    }

    function clearAll() {
      text1Area.value = '';
      text2Area.value = '';
      diffOutput.classList.remove('active');
      stats.style.display = 'none';
      location.hash = '';
    }

    // Event listeners
    compareBtn.addEventListener('click', compareTexts);
    swapBtn.addEventListener('click', swapTexts);
    clearBtn.addEventListener('click', clearAll);

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        compareTexts();
      }
    });

    // Load initial state
    loadState();
  </script>
</body>
</html>
